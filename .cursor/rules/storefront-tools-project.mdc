---
description: 
globs: 
alwaysApply: true
---
# Storefront Tools - Project Rules

## Project Overview

Storefront Tools is an AI-powered ecommerce catalog generation platform that creates complete brand identities, product catalogs, images, and marketing materials. The project uses a modern Next.js 15 stack with Vercel AI SDK UI for real-time AI interactions.

**Core Documentation**: 
- [PRD.md](mdc:docs/PRD.md) - Product Requirements Document
- [TECHNICAL_ARCHITECTURE.md](mdc:docs/TECHNICAL_ARCHITECTURE.md) - System Architecture
- [EXECUTION_PLAN.md](mdc:docs/EXECUTION_PLAN.md) - Implementation Plan
- [IMPLEMENTATION_SUMMARY.md](mdc:docs/IMPLEMENTATION_SUMMARY.md) - Current Status

## Technology Stack & Requirements

### Frontend Framework
- **Next.js 15** with App Router (required)
- **TypeScript 5.8+** for all code
- **PandaCSS** for styling (see [panda.config.ts](mdc:panda.config.ts))
- **React Server Components** + client components where needed
- **Radix UI** primitives for accessible components

### AI Integration (CRITICAL)
- **Vercel AI SDK UI** - Use ONLY client-side hooks, NO server actions
- **OpenAI GPT-4.1** - For all chat and text generation
- **OpenAI GPT-Image-1** - For ALL image generation (NEVER use DALL-E)
- **AI SDK Usage Rules**: Reference [ai-sdk-usage.mdc](mdc:.cursor/rules/ai-sdk-usage.mdc)

### Package Manager
- **ALWAYS use `pnpm`** - Never use npm or yarn
- Reference [package.json](mdc:package.json) for current dependencies

## AI SDK UI Architecture (MANDATORY APPROACH)

### Hook Usage Patterns
```typescript
// Brand Agent - Conversational + Structured Output
const { messages, input, handleSubmit, isLoading } = useChat({
  api: '/api/agents/brand'
})

const { object, submit } = useObject({
  api: '/api/agents/brand',
  schema: BrandSchema
})

// Product Agent - Structured Catalog Generation
const { object, submit, isLoading } = useObject({
  api: '/api/agents/products',
  schema: ProductCatalogSchema
})

// Image Agent - Prompt Completion + Generation
const { completion, submit, isLoading } = useCompletion({
  api: '/api/agents/images'
})
```

### Required API Routes Structure
```
app/api/agents/
├── brand/route.ts      - useChat & useObject compatible
├── products/route.ts   - useObject compatible
├── images/route.ts     - useCompletion compatible
├── marketing/route.ts  - useObject & useChat compatible
└── export/route.ts     - useCompletion compatible
```

## Five Core AI Agents

### 1. Brand Inventor Agent
- **Purpose**: Create comprehensive brand identities
- **Hooks**: `useChat` + `useObject`
- **API**: `/api/agents/brand`
- **Schema**: `BrandSchema` (see [schemas.ts](mdc:lib/schemas.ts))
- **Output**: Brand name, mission, values, target market, visual identity

### 2. Product Designer Agent  
- **Purpose**: Generate product catalogs with specifications
- **Hooks**: `useObject` primary, `useChat` for refinement
- **API**: `/api/agents/products`  
- **Schema**: `ProductCatalogSchema`
- **Output**: Structured product data with pricing, specs, categories

### 3. Image Generator Agent
- **Purpose**: Create product images using GPT-Image-1
- **Hooks**: `useCompletion` for prompts + custom image generation
- **API**: `/api/agents/images`
- **Model**: OpenAI GPT-Image-1 ONLY (never DALL-E)
- **Output**: Product images with metadata

### 4. Marketing Designer Agent
- **Purpose**: Build comprehensive design systems
- **Hooks**: `useObject` + `useChat`
- **API**: `/api/agents/marketing`
- **Schema**: `MarketingSystemSchema`
- **Output**: Color palettes, typography, marketing copy

### 5. Catalog Generator Agent
- **Purpose**: Export data for ecommerce platforms
- **Hooks**: `useCompletion` + custom export logic
- **API**: `/api/agents/export`
- **Output**: Shopify CSV, WooCommerce XML, JSON exports

## Component Architecture

### Reusable AI Components
```typescript
// Generic chat interface for any agent
<AgentChat 
  agentType="brand"
  onDataGenerated={handleBrandData}
  initialContext={brandContext}
/>

// Object generation with real-time streaming
<ObjectGenerator
  schema={BrandSchema}
  api="/api/agents/brand"
  prompt="Generate a luxury fashion brand"
  onComplete={handleBrandObject}
/>

// Text completion for prompts and configurations
<CompletionGenerator
  api="/api/agents/export"
  prompt="Configure Shopify export settings"
  onComplete={handleExportConfig}
/>
```

### UI Component Standards
- **Design System**: Reference [design-system.mdc](mdc:.cursor/rules/design-system.mdc)
- **PandaCSS**: Use design tokens, avoid hardcoded values
- **Accessibility**: Always include ARIA labels, keyboard navigation
- **TypeScript**: Strict typing for all props and state

## Data Flow & Storage

### Session-Based Architecture
```
/data/sessions/[sessionId]/
├── brand.json           - Brand identity data
├── products.json        - Product catalog
├── images.json          - Image metadata  
└── design-system.json   - Marketing assets

/public/generated-assets/[sessionId]/
├── images/              - Generated product images
├── exports/             - Platform export files
└── temp/                - Temporary processing files
```

### State Management
- **AI State**: Managed automatically by AI SDK UI hooks
- **Local State**: React useState/useReducer for UI state
- **Persistence**: File-based JSON storage via storage utilities
- **Real-time Updates**: Hook callbacks → storage → UI refresh

## Development Standards

### Code Quality
- **Early Returns**: Use early returns for better readability
- **Descriptive Names**: Use clear variable and function names
- **Event Handlers**: Prefix with "handle" (e.g., `handleSubmit`)
- **Constants**: Prefer `const` over `function` declarations
- **Type Safety**: Always define TypeScript interfaces

### Error Handling
```typescript
// AI SDK UI error handling
const { error, isLoading } = useChat({
  api: '/api/agents/brand',
  onError: (error) => {
    console.error('Brand agent error:', error)
    // Handle error appropriately
  }
})

if (error) {
  return <ErrorDisplay error={error} />
}
```

### Performance Optimization
- **Code Splitting**: Route-based and component-based
- **Lazy Loading**: Images and heavy components
- **Streaming**: Real-time AI responses via hooks
- **Caching**: API responses and generated assets

## File Structure Requirements

### Component Organization
```
components/
├── ui/                 - Basic UI components (Button, Input)
├── agents/             - Agent-specific components
│   ├── brand/
│   ├── product/
│   ├── image/
│   ├── marketing/
│   └── export/
├── shared/             - Shared components (ChatInterface)
└── ai/                 - AI SDK UI wrapper components
```

### API Route Organization
```
app/api/
├── agents/             - AI agent endpoints
├── storage/            - Data persistence
├── files/              - File management
└── data/               - Data CRUD operations
```

## Critical Don'ts

### ❌ NEVER DO THESE:
1. **Don't use server actions** - Only AI SDK UI hooks
2. **Don't reference DALL-E** - Only GPT-Image-1
3. **Don't use npm/yarn** - Only pnpm
4. **Don't hardcode styles** - Use PandaCSS tokens
5. **Don't create temp files** - Follow established patterns
6. **Don't ignore accessibility** - Always include ARIA support

### ❌ ANTI-PATTERNS:
- Manual stream parsing (hooks handle this)
- Server-side AI calls (use client hooks)
- Direct OpenAI SDK usage (use AI SDK UI)
- Mixing multiple package managers
- Creating example/demo files unless requested

## Project Phases

### Phase 1: Foundation (Current)
- Next.js 15 setup ✅
- AI SDK UI integration ✅  
- Basic routing structure ✅
- Component library foundation ✅

### Phase 2: Core Agents (Next)
- Build all 5 AI agent interfaces
- Implement AI SDK UI hooks
- Create API routes for each agent
- Build data persistence layer

### Phase 3: Integration & Export
- Agent workflow integration
- Export functionality for platforms
- UI polish and optimization
- Testing and deployment

## Getting Started

1. **Read Documentation**: Start with [PRD.md](mdc:docs/PRD.md) and [TECHNICAL_ARCHITECTURE.md](mdc:docs/TECHNICAL_ARCHITECTURE.md)
2. **Follow AI SDK Rules**: Reference [ai-sdk-usage.mdc](mdc:.cursor/rules/ai-sdk-usage.mdc) for all AI implementations
3. **Use pnpm**: Always `pnpm install`, `pnpm dev`, `pnpm build`
4. **Check Current Status**: Review [IMPLEMENTATION_SUMMARY.md](mdc:docs/IMPLEMENTATION_SUMMARY.md)

Remember: This is an AI-first application using cutting-edge Vercel AI SDK UI patterns. Every feature should leverage real-time streaming and structured data generation for the best user experience.
